{% extends 'incidencias/base.html' %}
{% block title %}Crear Incidencia{% endblock %}

{% block content %}
<div class="container mt-5 mb-5">
    <h2 class="text-primary mb-4">Parte de Incidencias TIC</h2>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}

        <!-- tipo-1: Telefónicos -->
        <div class="tipo tipo-1 d-none">
            <h5 class="text-primary">Líneas o Dispositivos Telefónicos Corporativos</h5>
            <label>Nº Etiqueta o IMEI *</label>
            <input class="form-control mb-2" name="imei">
            <label>Tipo Incidencia *</label>
            <input class="form-control mb-2" name="tipo_incidencia_1">
        </div>

        <!-- tipo-2: Ordenadores -->
        <div class="tipo tipo-2 d-none">
            <h5 class="text-primary">Ordenadores</h5>
            <label>Nº de Serie *</label>
            <input class="form-control mb-2" name="n_serie">
            <label>Nombre de la Sesión</label>
            <input class="form-control mb-2" name="sesion">
            <label>Tipo de Incidencia *</label>
            <input class="form-control mb-2" name="tipo_incidencia_2">
        </div>

        <!-- tipo-3: Internet -->
        <div class="tipo tipo-3 d-none">
            <h5 class="text-primary">Acceso a Internet</h5>
            <label>Fecha y Hora del fallo *</label>
            <input type="datetime-local" class="form-control mb-2" name="fecha_fallo">
            <label>Tipo de incidencia *</label>
            <input class="form-control mb-2" name="tipo_incidencia_3">
        </div>

        <!-- tipo-4: GSuite -->
        <div class="tipo tipo-4 d-none">
            <h5 class="text-primary">Cuenta Corporativa GSuite</h5>
            <label>Nombre de la cuenta *</label>
            <input class="form-control mb-2" name="cuenta_gsuite">
            <label>Tipo de incidencia *</label>
            <input class="form-control mb-2" name="tipo_incidencia_4">
        </div>

        <!-- tipo-5: Impresoras -->
        <div class="tipo tipo-5 d-none">
            <h5 class="text-primary">Impresoras</h5>
            <label>Tipo de incidencia *</label>
            <input class="form-control mb-2" name="tipo_incidencia_5">
        </div>

        <!-- tipo-6: Plataforma gestion -->
        <div class="tipo tipo-6 d-none">
            <h5 class="text-primary">Plataforma gestion.grupoanide</h5>
            <label>Nombre del trabajador *</label>
            <input class="form-control mb-2" name="trabajador_gestion">
            <label>Tipo de incidencia *</label>
            <input class="form-control mb-2" name="tipo_incidencia_6">
        </div>

        <!-- tipo-7: Dispositivos personales -->
        <div class="tipo tipo-7 d-none">
            <h5 class="text-primary">Cuentas Corporativas en Dispositivos Personales</h5>
            <label>Nombre y apellidos *</label>
            <input class="form-control mb-2" name="nombre_personal">
            <label>Teléfono o email *</label>
            <input class="form-control mb-2" name="contacto_personal">
            <label>Cuenta corporativa *</label>
            <input class="form-control mb-2" name="cuenta_personal">
            <label>Tipo de solicitud *</label>
            <input class="form-control mb-2" name="tipo_solicitud_personal">
            <label>IMEI *</label>
            <input class="form-control mb-2" name="imei_personal">
            <label>Marca/modelo *</label>
            <input class="form-control mb-2" name="modelo_personal">
            <label>Motivo de la solicitud *</label>
            <input class="form-control mb-2" name="motivo_solicitud">
            <label>Intervención solicitada *</label>
            <input class="form-control mb-2" name="intervencion_solicitada">
        </div>

        <!-- tipo-8: Control de accesos -->
        <div class="tipo tipo-8 d-none">
            <h5 class="text-primary">Control de accesos</h5>
            <label>Centro ANIDE afectado *</label>
            <input class="form-control mb-2" name="centro_anide">
            <label>Puesto de trabajo *</label>
            <input class="form-control mb-2" name="puesto_trabajo">
            <label>Nombre trabajador 8.1.a</label>
            <input class="form-control mb-2" name="nombre_8_1a">
            <label>Fecha/hora intervención 8.1.b</label>
            <input type="datetime-local" class="form-control mb-2" name="fecha_8_1b">
            <label>Urgencia 8.1.c</label>
            <input class="form-control mb-2" name="urgente_8_1c">
            <label>Nombre trabajador 8.2.a</label>
            <input class="form-control mb-2" name="nombre_8_2a">
            <label>Fecha/hora intervención 8.2.b</label>
            <input type="datetime-local" class="form-control mb-2" name="fecha_8_2b">
            <label>Urgencia 8.2.c</label>
            <input class="form-control mb-2" name="urgente_8_2c">
        </div>

        <!-- Siempre visibles -->
        <div class="mb-3 mt-4">
            <label for="descripcion" class="form-label">Descripción de la incidencia *</label>
            <textarea class="form-control" id="descripcion" name="descripcion" required></textarea>
        </div>

        <div class="mb-3">
            <label for="telefono" class="form-label">Teléfono de contacto *</label>
            <input type="text" class="form-control" id="telefono" name="telefono" required>
        </div>

        <!-- Botón final -->
        <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary px-5 py-2">Enviar</button>
        </div>
    </form>
</div>

<script>
    const relativa = document.getElementById("id_relativa");
    const secciones = document.querySelectorAll(".tipo");

    function mostrarSeccion() {
        const valor = relativa.value;
        secciones.forEach(div => div.classList.add("d-none"));
        const activa = document.querySelector(".tipo-" + valor);
        if (activa) activa.classList.remove("d-none");
    }

    if (relativa) {
        relativa.addEventListener("change", mostrarSeccion);
        mostrarSeccion();
    }
</script>
{% endblock %}
